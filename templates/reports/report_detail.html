{% extends 'base.html' %}
{% load static %}
{% block content %}
<style>
    .card-detail {
        border-radius: 18px;
        background: #ffffff;
        padding: 30px;
        box-shadow: 0 0 12px rgba(0,0,0,0.08);
    }
    .detail-label {
        font-weight: bold;
        color: #444;
    }
    .detail-value {
        margin-bottom: 15px;
        color: #333;
    }
    .btn-back {
        background-color: #007bff;
        color: white;
        border-radius: 10px;
        font-weight: 500;
        padding: 8px 20px;
    }
    .btn-back:hover {
        background-color: #0056b3;
    }
</style>

<div class="container mt-5 mb-5">
    <div class="card-detail">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="text-primary mb-0">Cybercrime Report Details</h3>
            {% if user.is_authenticated and user.role == 'admin' or user.role == 'officer' %}
            <a href="{% url 'all_reports' %}" class="btn btn-back">‚Üê Back to List</a>
            {% else %}
            <a href="{% url 'my_reports' %}" class="btn btn-back">‚Üê Back to List</a>
            {% endif %}
        </div>

        <div class="row">
            <div class="col-md-6">
                <p class="detail-label">Tracking ID:</p>
                <p class="detail-value">{{ report.tracking_id }}</p>
            </div>
            <div class="col-md-6">
                <p class="detail-label">Cybercrime Type:</p>
                <p class="detail-value">{{ report.crime_type }}</p>
            </div>

            <div class="col-md-6">
                <p class="detail-label">Status:</p>
                <p class="detail-value">{{ report.status }}</p>
            </div>
            {% if user.is_authenticated and user.role == 'admin' or user.role == 'officer' %}
            <div class="col-md-6">
                <p class="detail-label">Priority:</p>
                <p class="detail-value">{{ report.priority }}</p>
            </div>
            {% endif %}
            {% if user.is_authenticated and user.role == 'admin' or user.role == 'officer' %}
            <hr class="my-4">

              <form method="post" action="{% url 'update_status_priority' report.pk %}" class="row g-3 mt-2">
                {% csrf_token %}
            <div class="col-md-6">
        <label for="status" class="form-label">Status</label>
        <select name="status" id="status" class="form-select" required>
            <option value="Pending" {% if report.status == 'Pending' %}selected{% endif %}>Pending</option>
            <option value="Under Investigation" {% if report.status == 'Under Investigation' %}selected{% endif %}>Under Investigation</option>
            <option value="Resolved" {% if report.status == 'Resolved' %}selected{% endif %}>Resolved</option>
            <option value="Closed" {% if report.status == 'Closed' %}selected{% endif %}>Closed</option>
        </select>
    </div>
    <div class="col-md-6">
        <label for="priority" class="form-label">Priority</label>
        <select name="priority" id="priority" class="form-select" required>
            <option value="Low" {% if report.priority == 'Low' %}selected{% endif %}>Low</option>
            <option value="Medium" {% if report.priority == 'Medium' %}selected{% endif %}>Medium</option>
            <option value="High" {% if report.priority == 'High' %}selected{% endif %}>High</option>
            <option value="Critical" {% if report.priority == 'Critical' %}selected{% endif %}>Critical</option>
        </select>
    </div>
    <div class="col-12">
        <button type="submit" class="btn btn-primary mt-2">Update</button>
    </div>
</form>
          
            {% endif %}
            <hr class="my-4">
            <div class="col-md-6">
                <p class="detail-label">Date of Incident:</p>
                <p class="detail-value">{{ report.date }}</p>
            </div>
            <div class="col-md-6">
                <p class="detail-label">Submitted On:</p>
                <p class="detail-value">{{ report.date|date:"Y-m-d" }}</p>
            </div>

            <div class="col-md-4">
                <p class="detail-label">Country:</p>
                <p class="detail-value">{{ report.country }}</p>
            </div>
            <div class="col-md-4">
                <p class="detail-label">Province / City:</p>
                <p class="detail-value">{{ report.province_city }}</p>
            </div>
            <div class="col-md-4">
                <p class="detail-label">District:</p>
                <p class="detail-value">{{ report.district|default:"-" }}</p>
            </div>

            <div class="col-md-12">
                <p class="detail-label">Description:</p>
                <p class="detail-value">{{ report.description }}</p>
            </div>

            <div class="col-md-12">
                <p class="detail-label">Suspects:</p>
                <p class="detail-value">{{ report.suspects|default:"None provided" }}</p>
            </div>
            <div class="col-md-12">
                <p class="detail-label">Additional Contacts:</p>
                <p class="detail-value">{{  report.additional_contacts|default:"not yet provided" }}</p>
            </div>
            <hr class="my-4">
            <div class="col-md-12">
                <p class="detail-label">Additional information</p>
                <p class="detail-value">{{ report.more_details|default:"not yet provided" }}</p>
                {% if user.is_authenticated and user.role in 'citizen' %}
                <hr class="my-4">
                <div class="d-flex flex-wrap gap-3">
                    <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#additionalDetailsModal">‚ûï Send Additional Details</button>
        
                </div>
                {% endif %}
            </div>
            
            <hr class="my-4">
            <div class="col-md-12">
                <p class="detail-label">More Details:</p>
                <p class="detail-value">{{ report.more_details|default:"not yet requested" }}</p>
                {% if user.is_authenticated and user.role in 'admin officer' %}
                
                <div class="d-flex flex-wrap gap-3">
                    <button class="btn btn-outline-warning" data-bs-toggle="modal" data-bs-target="#requestMoreInfoModal">‚ùì Request More Info</button>
                    
                </div>
                {% endif %}
            </div>
            <hr class="my-4">
            <div class="col-md-12">
                <p class="detail-label">Recommendations:</p>
                <p class="detail-value">{{ report.recommendations|default:"not yet provided" }}</p>
                {% if user.is_authenticated and user.role in 'admin officer' %}
                
                <div class="d-flex flex-wrap gap-3">
        
                    <button class="btn btn-outline-success" data-bs-toggle="modal" data-bs-target="#recommendationModal">üí° Provide Recommendation</button>
                    
                </div>
                {% endif %}
            </div>
            <hr class="my-4">
            {% if report.evidence %}
            <div class="col-md-12">
                <p class="detail-label">Evidence:</p>
                <p class="detail-value">
                    <a href="{{ report.evidence.url }}" target="_blank" class="btn btn-sm btn-outline-secondary">
                        View / Download Evidence
                    </a>
                </p>
            </div>
            {% endif %}
        </div>


      
    </div>
</div>

<!-- Modals -->
<div class="modal fade" id="additionalDetailsModal" tabindex="-1">
  <div class="modal-dialog">
    <form method="post" action="{% url 'send_additional_details' report.pk %}">
      {% csrf_token %}
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Send Additional Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <textarea name="more_details" class="form-control" rows="4" placeholder="Enter additional details..." required></textarea>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Send</button>
        </div>
      </div>
    </form>
  </div>
</div>

<div class="modal fade" id="requestMoreInfoModal" tabindex="-1">
  <div class="modal-dialog">
    <form method="post" action="{% url 'request_more_info' report.pk %}">
      {% csrf_token %}
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Request More Information</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <textarea name="additional_contacts" class="form-control" rows="4" placeholder="What extra information do you need?" required></textarea>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-warning">Request</button>
        </div>
      </div>
    </form>
  </div>
</div>

<div class="modal fade" id="recommendationModal" tabindex="-1">
  <div class="modal-dialog">
    <form method="post" action="{% url 'provide_recommendation' report.pk %}">
      {% csrf_token %}
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Provide Recommendation</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <textarea name="recommendations" class="form-control" rows="4" placeholder="Enter your recommendation..." required></textarea>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">Submit</button>
        </div>
      </div>
    </form>
  </div>
</div>

{% if messages %}
<div class="container mt-3">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }}">{{ message }}</div>
    {% endfor %}
</div>
{% endif %}

<!-- Ensure Bootstrap JS is loaded -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

{% endblock %}
